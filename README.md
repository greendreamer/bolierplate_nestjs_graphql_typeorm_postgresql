# NestJS/TypeORM/GraphQL/PostgresQL

NestJS boilerplate with TypeORM, GraphQL and PostgreslQL

## Open for Contribution

Totally open for any Pull Request, please feel free to contribute in any ways.
There can be errors related with type or something. It would be very helpful to me for you to fix this errors.

## [NestJS](https://docs.nestjs.com/)

Base NestJS, We like it

## [TypeORM](https://typeorm.io/)

We use [Nestjs/TypeORM](https://docs.nestjs.com/techniques/database)
In this template, We've been trying not to use `Pure SQL` to make the most of TypeORM.

## [PostgresQL Database](https://www.postgresql.org/)

We use postgresQL for backend database, The default database taht will be used is named 'postgres'
You have to have postgresql Database server before getting started.
You can use [Docker postgresQL](https://hub.docker.com/_/postgres) to have server easily

## [GraphQL](https://graphql.org/)

##### packages: graphql, apollo-server-express and @nestjs/graphql, [graphqlUpload](https://www.npmjs.com/package/graphql-upload) ...

We use GraphQL in a Code First approach (our code will create the GraphQL Schemas).

We don't use [swagger](https://docs.nestjs.com/openapi/introduction) now, but you can use this if you want to.
You can see [playground](http://localhost:8000/graphql)

We use apollographql as playground. but if you want to use default playground, you can do like below.

```js
// app.modules.js

GraphQLModule.forRootAsync <
  ApolloDriverConfig >
  {
    ...
    useFactory: (configService: ConfigService) => ({
      ...
      playground: true,
      ...
    }),
    ...
  };
```

### Protected queries/mutation by user role with guard

Some of the GraphQL queries are protected by a NestJS Guard (`GraphqlPassportAuthGuard`) and requires you to be authenticated (and some also requires to have the Admin role).
You can solve them with Sending JWT token in `Http Header` with the `Authorization`.

```json
# Http Header
{
  "Authorization": "Bearer TOKEN"
}
```

#### Example of some protected GraphQL

- getMe (must be authenticated)
- All the other generated by generator (must be authenticated and must be admin)

## License

MIT

## Custom CRUD

To make most of GraphQL's advantage, We created its own api, such as GetMany or GetOne.
We tried to make it as comfortable as possible, but if you find any mistakes or improvements, please point them out or promote them.

You can see detail in `declare.module.ts`, `processWhere.ts` and `custom.input.ts`

```js
// query
query($input:GetManyInput) {
  getManyPlaces(input:$input){
    data{
      id
      logitude
      count
    }
  }
}
```

```js
// variables
{
  input: {
    pagination: {
      size: 10,
      page: 0, // Started from 0
    },
    order: { id: 'DESC' },
    relations: ['place'],
    dataType: 'data', //all or count or data - default: all
    where: {
      id: 3,
    },
  },
};
```

You can see detail of operators in where below or in code.

<div style='background-color:rgb(22,22,22);'>
  <h1>Where</h1>

  <div style='display:flex; flex-wrap:wrap; gap:20px; padding:10px;'>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Equal</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: 3 </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Contains(case-sensitive)</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$contains: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Not equal</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$ne: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Not Contains(case-sensitive)</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$nContains: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Less than</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$lt: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Is null</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$null: true </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Less than or equal</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$lte: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Is not null</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$notNull: true </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Greate than</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$gt: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Is between</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$between: [3, 4] </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Greater than or equal</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$gte: 3 </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Joins the where in an "or" expression</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: [</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: 3 </div>
        <div>&ensp;&ensp;} </div>
        <div>&ensp;&ensp;place: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: 3 </div>
        <div>&ensp;&ensp;} </div>
        <div>] </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//In</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$in: [1, 2, 3] </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">//Joins the where in an "and" expression</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: 3, </div>
        <div>&ensp;&ensp;&ensp;&ensp;nickname: "man", </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    <div style='width: calc(50% - 20px);'>
      <div style="color: rgb(18,97,34)">// Not in</div>
      <div style='color: rgb(75,85,93)'>
        <div>where: {</div>
        <div>&ensp;&ensp;user: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;id: { </div>
        <div>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;$nIn: [1, 2, 3] </div>
        <div>&ensp;&ensp;&ensp;&ensp;} </div>
        <div>&ensp;&ensp;} </div>
        <div>} </div>
      </div>
    </div>
    
  </div>
</div>

## Code generator

There is [CRUD Generator in NestJS](https://docs.nestjs.com/recipes/crud-generator).
In this repository, It has its own generator.
You can use like below.

```bash
$ yarn g
```

## Getting Started

### Installation

Before you start, make sure you have a recent version of [NodeJS](http://nodejs.org/) environment _>=14.0_ with NPM 6 or Yarn.

The first thing you will need is to install NestJS CLI.

```bash
$ yarn -g @nestjs/cli
```

And do install the dependencies

```bash
$ yarn install # or npm install
```

### Run

for development

```bash
$ yarn dev # or npm dev
```

for production

```bash
$ yarn start # or npm start
```

## Todo

- [ ] Strict typescript
- [ ] Get Jest(e2e or unit test) to be work
- [ ] Add Many OAUths (Both of front and back end)
  - [ ] Kakao
  - [ ] Google
  - [ ] Apple
  - [ ] Naver
